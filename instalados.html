<!DOCTYPE html>
<html lang="">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
        <title id="titulo">Central de aplicativos</title>
        <meta name="description" content="Encontre, baixe, atualize aplicativos para o sistema">
        <link rel="stylesheet" href="res/styles/index.css">
        <link rel="manifest" href="res/manifest.json">
        <link rel="search" href="/opensearch.xml" type="application/opensearchdescription+xml" title="Central de aplicativos Andistro">

        <!--[OG TAGS]-->
        <meta property="og:site_name" content="Central de aplicativos AnDistro">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://andistro.github.io/software-center"> <!--URL do site-->

        <!--[MICROSOFT TAGS]-->
        <meta name="msapplication-TileColor" content=""> <!--Cor HEX-->
        <meta name="msapplication-TileImage" content=""> <!--Imagem quadrada-->

        <!--[TAGS DE VERIFICA√á√ÉO]-->
        <meta name="google-site-verification" content="">
        <meta name="msvalidate.01" content="">
        <meta name="yandex-verification" content="">

        <!--[SCHEMA.ORG]-->
        <script type="application/ld+json">
            {
            "@type": "WebPage",
            "name": "Central de aplicativos AnDistro |",
            "url": "https://andistro.github.io/software-center",
            "@context": "http://schema.org"
            }
        </script>
    </head>
    <body>
        <div class="app">
            <aside class="menu">
                <a href="index.html">
                    <div class="logo">
                        <img src="res/img/ic_logo.svg" alt="In√≠cio">
                    </div>
                </a>

                <a href="index.html">
                    <button class="menu-btn">
                        <img src="res/img/ic_home_active.svg" alt="In√≠cio">
                        <span data-i18n="navigation.home">In√≠cio</span>
                    </button>
                </a>

                <a href="#">
                    <button class="menu-btn active">
                        <img src="res/img/ic_apps.svg" alt="Aplicativos">
                        <span data-i18n="navigation.installed">Instalados</span>
                    </button>
                </a>

                <a href="atualizacoes.html">
                    <button class="menu-btn">
                        <img src="res/img/ic_update.svg" alt="Atualiza√ß√µes">
                        <span data-i18n="navigation.search_updates">Procurar atualiza√ß√µes</span>
                    </button>
                </a>
            </aside>

            <section class="content">
                <form class="pesquisa" id="search-form">
                    <input id="search-input" type="text" placeholder="Fa√ßa uma pesquisa">
                    <button id="search-btn" class="btn-search" type="submit">
                        <img src="res/img/ic_search.svg" alt="Buscar">
                    </button>
                </form>
                
                <section class="main">
                    <h2 class="title">Instalados</h2>
                    <div id="cards-container"></div>
                </section>
            </section>
        </div>
        <script src="i18n.js"></script>
        <script src="detect.js"></script>
        <script src="instalados.js"></script>
        <script>
            // para as pesquisas
            const form = document.getElementById("search-form");
            const input = document.getElementById("search-input");

            form.addEventListener("submit", (e) => {
            e.preventDefault();

            const termo = input.value.trim();
            if (!termo) return;

            // pega todos os par√¢metros atuais da URL
            const currentParams = new URLSearchParams(window.location.search);

            // for√ßa/atualiza o q={searchTerms}
            currentParams.set("q", termo);

            const qs = currentParams.toString();
            window.location.href = `resultados.html?${qs}`;
            });

            async function instalarPacote(nomePacote) {
                if (!window.__IS_ANDISTRO__) {
                    // aqui voc√™ pode trocar alert por um toast/overlay depois
                    alert("Instala√ß√£o dispon√≠vel apenas no AnDistro.");
                    return;
                }

                try {
                const res = await fetch("http://127.0.0.1:27777/install", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ pkg: nomePacote })
                });
                if (!res.ok) throw new Error(`HTTP ${res.status}`);

                // opcional: tratar resposta, exibir status, etc.
                // const data = await res.json();
                // console.log(data);
                } catch (e) {
                    console.error("Erro ao solicitar instala√ß√£o", e);
                    alert("Erro ao solicitar instala√ß√£o no AnDistro.");
                }
            }
        </script>
        <script>
            (async function i18nInit() {
                console.log('üåê Lang detectado:', i18n.getLanguage());

                await i18n.loadLanguages({
                    'pt-BR': './translations/pt-br.json',
                    'en-US': './translations/en-us.json'
                });

                i18n.translatePage();

                // --- Propagar ?lang= para todos os links internos ---
                const urlParams = new URLSearchParams(window.location.search);
                const langParam = urlParams.get('lang');

                if (langParam) {
                    const links = document.querySelectorAll('a[href]');
                    links.forEach(a => {
                        const href = a.getAttribute('href');

                        // Ignora anchors, javascript:, mailto:, links externos absolutos, etc.
                        if (
                            href.startsWith('#') ||
                            href.startsWith('javascript:') ||
                            href.startsWith('mailto:') ||
                            href.startsWith('tel:') ||
                            href.startsWith('http://') ||
                            href.startsWith('https://')
                        ) {
                            return;
                        }

                        const url = new URL(href, window.location.origin);
                        const params = new URLSearchParams(url.search);

                        // S√≥ sobrescreve se ainda n√£o tiver lang
                        if (!params.has('lang')) {
                            params.set('lang', langParam);
                        }

                        url.search = params.toString();
                        a.setAttribute('href', url.pathname + (url.search ? '?' + url.searchParams.toString() : ''));
                    });
                }
            })();
        </script>

    </body>
</html>